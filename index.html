<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Retiros - LBSNG</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <meta name="theme-color" content="#002855">
    <link rel="icon" href="https://i.postimg.cc/sxxwfhwK/LOGO-LBSNG-06-237x300.png">
</head>
<body>
    <div class="background-gradient"></div>
    <div class="background-pattern"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text">Procesando...</div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- User Modal -->
    <div id="userModal" class="modal hidden">
        <div class="modal-content">
            <div class="user-modal">
                <div class="modal-header">
                    <h2>Identificaci√≥n de Usuario</h2>
                    <p class="modal-subtitle">Selecciona tu usuario o registra uno nuevo</p>
                </div>
                <div class="modal-body">
                    <div class="input-wrapper">
                        <label class="input-label">
                            <span>Seleccionar Usuario Existente</span>
                        </label>
                        <select id="userSelectInput">
                            <option value="">-- Seleccionar usuario existente --</option>
                        </select>
                        <span class="input-error"></span>
                    </div>
                    
                    <div class="divider-or">
                        <span>O registrar nuevo usuario</span>
                    </div>
                    
                    <div class="input-wrapper">
                        <label class="input-label">
                            <span>Nombre Completo</span>
                        </label>
                        <input type="text" id="userNameInput" placeholder="Ej: Mar√≠a P√©rez" maxlength="50">
                        <span class="input-error"></span>
                    </div>
                    <div class="input-wrapper">
                        <label class="input-label">
                            <span>Cargo</span>
                        </label>
                        <select id="userRoleInput">
                            <option value="">Seleccione su cargo</option>
                            <option value="Asistente de Educaci√≥n">Asistente de Educaci√≥n</option>
                            <option value="Inspector/a">Inspector/a</option>
                            <option value="Secretaria/o">Secretaria/o</option>
                            <option value="Coordinador/a">Coordinador/a</option>
                            <option value="Director/a">Director/a</option>
                            <option value="Otro">Otro</option>
                        </select>
                        <span class="input-error"></span>
                    </div>
                    <button id="btnSaveUser" class="btn-secondary">
                        <span>Iniciar Sesi√≥n / Registrar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="header-container">
            <div class="header-brand">
                <div class="brand-logo">
                    <img src="https://i.postimg.cc/sxxwfhwK/LOGO-LBSNG-06-237x300.png" alt="Logo LBSNG" class="inst-logo">
                </div>
                <div class="brand-text">
                    <h1>Control de Retiros Escolares</h1>
                    <p class="brand-subtitle">Liceo Bicentenario Nuestra Se√±ora de Guadalupe</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="header-info">
                    <div class="header-date">
                        <span class="icon-calendar">üìÖ</span>
                        <span id="currentDate">Cargando...</span>
                    </div>
                    <div class="header-time">
                        <span class="icon-clock">üïê</span>
                        <span id="currentTime">00:00:00</span>
                    </div>
                </div>
                <button id="btnUser" class="btn-user" title="Cambiar usuario">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </button>
                <button id="themeToggle" class="theme-toggle" title="Cambiar tema">
                    <span class="sun-icon">‚òÄÔ∏è</span>
                    <span class="moon-icon">üåô</span>
                </button>
            </div>
        </div>
    </header>

    <!-- User Badge -->
    <div id="userBadge" class="user-badge hidden">
        <svg class="user-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <span id="userName">Usuario</span>
    </div>

    <div class="container">
        <!-- KPI Dashboard -->
        <div class="dashboard-kpis">
            <div class="kpi-card kpi-total">
                <div class="kpi-icon-container">
                    <span class="kpi-icon">üéí</span>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Total Activos</div>
                    <div class="kpi-value" id="activeBadge">0</div>
                </div>
            </div>
            <div class="kpi-card kpi-time">
                <div class="kpi-icon-container">
                    <span class="kpi-icon">‚è±Ô∏è</span>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Tiempo Promedio</div>
                    <div class="kpi-value" id="avgTimeBadge">0 min</div>
                </div>
            </div>
            <div class="kpi-card kpi-completed">
                <div class="kpi-icon-container">
                    <span class="kpi-icon">‚úÖ</span>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Completados Hoy</div>
                    <div class="kpi-value" id="completedBadge">0</div>
                </div>
            </div>
            <div class="kpi-card kpi-exceeded">
                <div class="kpi-icon-container">
                    <span class="kpi-icon">‚ö†Ô∏è</span>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Tiempo Excedido</div>
                    <div class="kpi-value" id="exceededBadge">0</div>
                </div>
            </div>
        </div>

        <!-- Formulario de Registro -->
        <div class="form-container">
            <div class="form-header">
                <div class="form-header-icon">
                    <span>‚ûï</span>
                </div>
                <h2>Registrar Nueva Salida</h2>
            </div>
            <div class="form-body">
                <form id="addForm">
                    <div class="input-group">
                        <div class="input-wrapper">
                            <label class="input-label">
                                <span class="label-icon">üë§</span>
                                <span>Nombre del Alumno</span>
                            </label>
                            <input type="text" id="nameInput" placeholder="Ingrese nombre completo del alumno" autocomplete="off" required>
                            <span class="input-error"></span>
                        </div>
                        <div class="input-wrapper">
                            <label class="input-label">
                                <span class="label-icon">üìö</span>
                                <span>Curso</span>
                            </label>
                            <select id="courseInput" required>
                                <option value="">Seleccione el curso</option>
                                <option value="Pre Kinder A">Pre Kinder A</option>
                                <option value="Pre Kinder B">Pre Kinder B</option>
                                <option value="Kinder A">Kinder A</option>
                                <option value="Kinder B">Kinder B</option>
                                <option value="1¬∞ B√°sico A">1¬∞ B√°sico A</option>
                                <option value="1¬∞ B√°sico B">1¬∞ B√°sico B</option>
                                <option value="2¬∞ B√°sico A">2¬∞ B√°sico A</option>
                                <option value="2¬∞ B√°sico B">2¬∞ B√°sico B</option>
                                <option value="3¬∞ B√°sico A">3¬∞ B√°sico A</option>
                                <option value="3¬∞ B√°sico B">3¬∞ B√°sico B</option>
                                <option value="4¬∞ B√°sico A">4¬∞ B√°sico A</option>
                                <option value="4¬∞ B√°sico B">4¬∞ B√°sico B</option>
                                <option value="5¬∞ B√°sico A">5¬∞ B√°sico A</option>
                                <option value="5¬∞ B√°sico B">5¬∞ B√°sico B</option>
                                <option value="6¬∞ B√°sico A">6¬∞ B√°sico A</option>
                                <option value="6¬∞ B√°sico B">6¬∞ B√°sico B</option>
                                <option value="7¬∞ B√°sico A">7¬∞ B√°sico A</option>
                                <option value="7¬∞ B√°sico B">7¬∞ B√°sico B</option>
                                <option value="8¬∞ B√°sico A">8¬∞ B√°sico A</option>
                                <option value="8¬∞ B√°sico B">8¬∞ B√°sico B</option>
                                <option value="I¬∞ Medio A">I¬∞ Medio A</option>
                                <option value="I¬∞ Medio B">I¬∞ Medio B</option>
                                <option value="II¬∞ Medio A">II¬∞ Medio A</option>
                                <option value="II¬∞ Medio B">II¬∞ Medio B</option>
                                <option value="III¬∞ Medio A">III¬∞ Medio A</option>
                                <option value="III¬∞ Medio B">III¬∞ Medio B</option>
                                <option value="IV¬∞ Medio A">IV¬∞ Medio A</option>
                                <option value="IV¬∞ Medio B">IV¬∞ Medio B</option>
                            </select>
                            <span class="input-error"></span>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <label class="input-label">
                            <span class="label-icon">üìù</span>
                            <span>Motivo del Retiro</span>
                        </label>
                        <select id="reasonInput" required>
                            <option value="">Seleccione el motivo</option>
                            <option value="Cita M√©dica">Cita M√©dica</option>
                            <option value="Cita Dental">Cita Dental</option>
                            <option value="Enfermedad">Enfermedad</option>
                            <option value="Malestar General">Malestar General</option>
                            <option value="Tr√°mite Personal">Tr√°mite Personal</option>
                            <option value="Tr√°mite Familiar">Tr√°mite Familiar</option>
                            <option value="Retiro Anticipado">Retiro Anticipado</option>
                            <option value="Emergencia Familiar">Emergencia Familiar</option>
                            <option value="Otro Motivo">Otro Motivo</option>
                        </select>
                        <span class="input-error"></span>
                    </div>
                    <button type="submit" class="btn-primary">
                        <span class="btn-icon">‚ûï</span>
                        <span>Registrar Salida</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item stat-espera">
                <div class="stat-indicator"></div>
                <div class="stat-info">
                    <div class="stat-label">En Espera</div>
                    <div class="stat-count" id="countEspera">0</div>
                </div>
            </div>
            <div class="stat-item stat-busca">
                <div class="stat-indicator"></div>
                <div class="stat-info">
                    <div class="stat-label">En B√∫squeda</div>
                    <div class="stat-count" id="countBusca">0</div>
                </div>
            </div>
            <div class="stat-item stat-avisado">
                <div class="stat-indicator"></div>
                <div class="stat-info">
                    <div class="stat-label">Avisado</div>
                    <div class="stat-count" id="countAvisado">0</div>
                </div>
            </div>
            <div class="stat-item stat-finalizado">
                <div class="stat-indicator"></div>
                <div class="stat-info">
                    <div class="stat-label">Finalizados</div>
                    <div class="stat-count" id="countFinalizados">0</div>
                </div>
            </div>
        </div>

        <!-- Students List -->
        <div class="students-section">
            <div class="section-header">
                <h3>
                    <span class="section-icon">üìã</span>
                    <span>Alumnos en Proceso de Retiro</span>
                </h3>
                <span class="section-badge" id="activeCount">0</span>
            </div>
            <ul class="student-list" id="studentList">
                <li class="empty-msg">
                    <div class="empty-icon">üì≠</div>
                    <span class="empty-text">Sin alumnos en proceso de retiro</span>
                    <span class="empty-subtext">Los nuevos registros aparecer√°n aqu√≠ autom√°ticamente</span>
                </li>
            </ul>
        </div>

        <!-- Template for Student Cards -->
        <template id="itemTemplate">
            <li class="card">
                <div class="card-time-badge time-badge">0 min</div>
                <div class="card-content">
                    <div class="card-info">
                        <div class="card-name"></div>
                        <div class="card-details"></div>
                        <div class="card-responsable">Responsable: <span class="responsable-name"></span></div>
                    </div>
                    <div class="progress-indicator">
                        <div class="progress-bar"></div>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="state-btn"></button>
                    <button class="btn-whatsapp" title="Notificar por WhatsApp">
                        <span>üì±</span>
                    </button>
                    <button class="btn-done" title="Finalizar Retiro">
                        <span>‚úÖ</span>
                    </button>
                    <button class="btn-delete" title="Eliminar">
                        <span>üóëÔ∏è</span>
                    </button>
                </div>
            </li>
        </template>

        <!-- Reportes Section -->
        <div class="report-section">
            <div class="report-card">
                <div class="report-header">
                    <div class="report-info">
                        <div class="report-icon">
                            <span>üìä</span>
                        </div>
                        <div>
                            <h3>Estad√≠sticas y Reportes</h3>
                            <p class="report-subtitle">An√°lisis mensual de retiros</p>
                        </div>
                    </div>
                    <div class="report-actions">
                        <button onclick="exportToPDF()" class="btn-export" title="Generar Reporte PDF">
                            <span>üìÑ</span>
                            <span>Reporte PDF</span>
                        </button>
                    </div>
                </div>
                <div class="report-body">
                    <div class="chart-container">
                        <canvas id="monthlyChart" height="300"></canvas>
                    </div>
                    <div class="ranking-header">
                        <h4>Ranking por Curso (Total)</h4>
                    </div>
                    <div id="topAlumnoDisplay">
                        <div class="loading-text">Cargando estad√≠sticas...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline Section -->
        <div class="timeline-section">
            <div class="section-header">
                <h3>
                    <span class="section-icon">üïê</span>
                    <span>L√≠nea de Tiempo - Hoy</span>
                </h3>
            </div>
            <div class="timeline-container" id="timelineContainer">
                <div class="empty-msg">
                    <span class="empty-text">No hay eventos registrados hoy</span>
                </div>
            </div>
        </div>

        <!-- Withdrawn Today Section -->
        <div class="withdrawn-section">
            <div class="section-header">
                <h3>
                    <span class="section-icon">‚úÖ</span>
                    <span>Alumnos Retirados Hoy</span>
                </h3>
                <div class="history-controls">
                    <span id="withdrawnCount" class="section-badge-secondary">0</span>
                    <button id="toggleWithdrawn" class="btn-toggle active">
                        <span>Ocultar</span>
                        <span class="toggle-icon">‚ñº</span>
                    </button>
                </div>
            </div>
            <div class="withdrawn-grid" id="withdrawnToday">
                <div class="empty-msg">
                    <div class="empty-icon">üì≠</div>
                    <span class="empty-text">No hay alumnos retirados hoy</span>
                    <span class="empty-subtext">Los retiros finalizados aparecer√°n en esta secci√≥n</span>
                </div>
            </div>
        </div>

        <!-- Historial Completo -->
        <div class="history-container">
            <div class="section-header">
                <h3>
                    <span class="section-icon">üìÅ</span>
                    <span>Historial Completo</span>
                </h3>
                <button id="toggleHistory" class="btn-toggle">
                    <span>Ver historial</span>
                    <span class="toggle-icon">‚ñº</span>
                </button>
            </div>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">
                <img src="https://i.postimg.cc/sxxwfhwK/LOGO-LBSNG-06-237x300.png" alt="Logo LBSNG" class="footer-logo">
                <div>
                    <h4 class="footer-title">Liceo Bicentenario NSG</h4>
                    <p class="footer-copyright">¬© 2026 Sistema de Control de Retiros - Todos los derechos reservados</p>
                </div>
            </div>
            <div class="footer-info">
                <p class="footer-version">Versi√≥n 2.1.0</p>
                <p class="footer-dev">Desarrollado por Franco</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <audio id="sound-add" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-click-2384.mp3" preload="auto"></audio>
    <audio id="sound-status" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-beep-2383.mp3" preload="auto"></audio>
    <audio id="sound-finish" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-complete-notification-2377.mp3" preload="auto"></audio>
    <audio id="sound-success" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>
</body>
</html>
